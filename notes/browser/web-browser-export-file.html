<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‰ç«¯æ‰¹é‡å¯¼å‡ºæ¥å£æ•°æ®æ–¹æ¡ˆ | æŸå–µå–µ</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="ç®€å•è®°å½•ã€å­¦ä¹ ç¬”è®°">
    
    <link rel="preload" href="/blog/assets/css/0.styles.144fa934.css" as="style"><link rel="preload" href="/blog/assets/js/app.f8d55777.js" as="script"><link rel="preload" href="/blog/assets/js/2.9875f188.js" as="script"><link rel="preload" href="/blog/assets/js/16.76fb416d.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.12a746c0.js"><link rel="prefetch" href="/blog/assets/js/11.e589b28a.js"><link rel="prefetch" href="/blog/assets/js/12.d7f69a0d.js"><link rel="prefetch" href="/blog/assets/js/13.78ef516b.js"><link rel="prefetch" href="/blog/assets/js/14.890c0bbf.js"><link rel="prefetch" href="/blog/assets/js/15.2ded1311.js"><link rel="prefetch" href="/blog/assets/js/17.9b70c6a6.js"><link rel="prefetch" href="/blog/assets/js/18.eac3edd8.js"><link rel="prefetch" href="/blog/assets/js/19.15ea688e.js"><link rel="prefetch" href="/blog/assets/js/20.f4f2564b.js"><link rel="prefetch" href="/blog/assets/js/21.c8cf4362.js"><link rel="prefetch" href="/blog/assets/js/22.56e6986d.js"><link rel="prefetch" href="/blog/assets/js/23.a5565786.js"><link rel="prefetch" href="/blog/assets/js/24.ef7d6995.js"><link rel="prefetch" href="/blog/assets/js/25.a9c02ac5.js"><link rel="prefetch" href="/blog/assets/js/26.77995ffd.js"><link rel="prefetch" href="/blog/assets/js/27.0373c9dc.js"><link rel="prefetch" href="/blog/assets/js/28.186384fd.js"><link rel="prefetch" href="/blog/assets/js/29.fb7b2b82.js"><link rel="prefetch" href="/blog/assets/js/3.446fcee1.js"><link rel="prefetch" href="/blog/assets/js/30.65274b10.js"><link rel="prefetch" href="/blog/assets/js/31.55b2efaa.js"><link rel="prefetch" href="/blog/assets/js/32.977599e7.js"><link rel="prefetch" href="/blog/assets/js/33.2ba845ff.js"><link rel="prefetch" href="/blog/assets/js/34.4e23bcaf.js"><link rel="prefetch" href="/blog/assets/js/35.b4dbff7c.js"><link rel="prefetch" href="/blog/assets/js/36.892623ef.js"><link rel="prefetch" href="/blog/assets/js/37.20db8c90.js"><link rel="prefetch" href="/blog/assets/js/38.f65dc72f.js"><link rel="prefetch" href="/blog/assets/js/39.95de0fa6.js"><link rel="prefetch" href="/blog/assets/js/4.48c34b70.js"><link rel="prefetch" href="/blog/assets/js/40.72a20d87.js"><link rel="prefetch" href="/blog/assets/js/41.68381aaa.js"><link rel="prefetch" href="/blog/assets/js/42.d4e1858e.js"><link rel="prefetch" href="/blog/assets/js/43.7380438e.js"><link rel="prefetch" href="/blog/assets/js/44.3344524d.js"><link rel="prefetch" href="/blog/assets/js/45.68e0ee32.js"><link rel="prefetch" href="/blog/assets/js/46.8f702e0b.js"><link rel="prefetch" href="/blog/assets/js/47.988df742.js"><link rel="prefetch" href="/blog/assets/js/5.b6391433.js"><link rel="prefetch" href="/blog/assets/js/6.66f56766.js"><link rel="prefetch" href="/blog/assets/js/7.b9c34bfd.js"><link rel="prefetch" href="/blog/assets/js/8.47ce4284.js"><link rel="prefetch" href="/blog/assets/js/9.c9ac39cc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.144fa934.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/images/icon.jpeg" alt="æŸå–µå–µ" class="logo"> <span class="site-name can-hide">æŸå–µå–µ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¬”è®°" class="dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¬”è®°" class="mobile-dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/notes/linux/shell-export-var-to-nodejs.html" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/vue/concis-event-bus.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/react/call-child-component-method.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/javascript/promise-resolve-and-return.html" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/network/" class="nav-link">
  ç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/browser/anchor-setting.html" class="nav-link">
  æµè§ˆå™¨ç›¸å…³
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="mobile-dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/design/offline/" class="nav-link">
  ç¦»çº¿åŒ…
</a></li><li class="dropdown-item"><!----> <a href="/blog/design/devops/gitlab-ci.html" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="mobile-dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tools/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/charles/" class="nav-link">
  charles
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/github/github-actions.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/webpack/md-to-html-loader.html" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Tennesseesunshine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¬”è®°" class="dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¬”è®°" class="mobile-dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/notes/linux/shell-export-var-to-nodejs.html" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/vue/concis-event-bus.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/react/call-child-component-method.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/javascript/promise-resolve-and-return.html" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/network/" class="nav-link">
  ç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/browser/anchor-setting.html" class="nav-link">
  æµè§ˆå™¨ç›¸å…³
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="mobile-dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/design/offline/" class="nav-link">
  ç¦»çº¿åŒ…
</a></li><li class="dropdown-item"><!----> <a href="/blog/design/devops/gitlab-ci.html" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="mobile-dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tools/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/charles/" class="nav-link">
  charles
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/github/github-actions.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/webpack/md-to-html-loader.html" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Tennesseesunshine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/notes/browser/anchor-setting.html" class="sidebar-link">è®¾ç½®é”šç‚¹</a></li><li><a href="/blog/notes/browser/browser-download.html" class="sidebar-link">æµè§ˆå™¨ä¸‹è½½æ–¹æ³•</a></li><li><a href="/blog/notes/browser/event-loop.html" class="sidebar-link">äº‹ä»¶å¾ªç¯</a></li><li><a href="/blog/notes/browser/http-cache.html" class="sidebar-link">HTTP ç¼“å­˜æ¢ç©¶</a></li><li><a href="/blog/notes/browser/http2-notes.html" class="sidebar-link">http2.0 å­¦ä¹ ç¬”è®°</a></li><li><a href="/blog/notes/browser/web-browser-export-file.html" aria-current="page" class="active sidebar-link">å‰ç«¯æ‰¹é‡å¯¼å‡ºæ¥å£æ•°æ®æ–¹æ¡ˆ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/notes/browser/web-browser-export-file.html#node-é…åˆ" class="sidebar-link">node é…åˆ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/notes/browser/web-browser-export-file.html#node-å±‚" class="sidebar-link">node å±‚</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/web-browser-export-file.html#web-è¯·æ±‚" class="sidebar-link">web è¯·æ±‚</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/web-browser-export-file.html#çº¯å‰ç«¯æ–¹æ¡ˆ" class="sidebar-link">çº¯å‰ç«¯æ–¹æ¡ˆ</a></li></ul></li><li><a href="/blog/notes/browser/web-performance.html" class="sidebar-link">éƒ¨åˆ† web æ€§èƒ½ä¼˜åŒ–æ¸…å• ğŸ§¾</a></li><li><a href="/blog/notes/browser/website-realize-pwa.html" class="sidebar-link">ä¸ºåšå®¢å¢åŠ PWAåŠŸèƒ½</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>ä¸­åå°å¯¼å‡ºæ•°æ®çš„éœ€æ±‚åœºæ™¯ç›®å‰å·²ç»æ˜¯éå¸¸å¸¸è§çš„ï¼Œæ‰€ä»¥åœ¨ä¸ªäººé‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œå°è¯•å‰ç«¯è§£å†³å¹¶ä¸”ä½¿ç”¨çš„ä¸€äº›æ–¹æ¡ˆã€‚</p> <p>ç›®å‰æ€»ç»“äº†ä¸‹ï¼Œå¤§è‡´ä¸¤ä¸ªæ–¹æ¡ˆï¼šè¦ä¹ˆå¯¼å‡º <code>excel</code>ï¼Œè¦ä¹ˆå¯¼å‡º <code>csv</code>ï¼Œå…·ä½“åœ¨å“ª <code>node</code> å±‚è¿˜æ˜¯æµè§ˆå™¨å¯ä»¥çœ‹éœ€æ±‚ä»¥åŠæ€§èƒ½æ¥è°ƒæ•´ã€‚</p> <h2 id="node-é…åˆ"><a href="#node-é…åˆ" class="header-anchor">#</a> node é…åˆ</h2> <p>è¿™ä¸ªå‰ææ˜¯æœ‰ <code>node</code> ä½œä¸ºä¸­é—´å±‚ <code>node</code> å±‚å°† <code>json</code> æ•°æ®è½¬æ¢ä¸ºæµï¼Œå¯ä»¥æŠŠä¸€äº›æ•°æ®åœ¨è¿™ä¸€å±‚é€‚é…ï¼Œæ‰€ä»¥ä¸€äº›æ•°æ®çš„æ˜ å°„ã€ä»£ç çš„å¤ç”¨ä¹Ÿéƒ½å¯ä»¥åœ¨è¿™ä¸€å±‚ï¼Œåœ¨è¿™ä¸€å±‚å°† <code>json</code> è½¬ä¸ºæµ <code>excel</code>ã€‚</p> <p>æ€è·¯å°±æ˜¯å‰ç«¯å‘èµ·ä¸€ä¸ªè¯·æ±‚ï¼Œå°†è¯·æ±‚å‚æ•°ç»™ <code>node</code> ï¼Œ<code>node</code> åˆ©ç”¨ <code>axios</code> å‘èµ·å¤šä¸ªè¯·æ±‚ï¼Œè¯·æ±‚çš„å°±æ˜¯å¯¼å‡ºæ•°æ®çš„æ¥å£ï¼Œä½†æ˜¯æ¥å£è¿”å›çš„æ˜¯ <code>json</code> æ•°æ®ï¼Œæ‰€ä»¥åœ¨ç”¨ <code>Promise.all</code> è¯·æ±‚å®Œæˆæ•°æ®ä¹‹åï¼Œåœ¨æœåŠ¡ç«¯åˆ©ç”¨ <code>xlsx</code> çš„åŒ…å°† <code>json</code> æ•°æ®è½¬ä¸ºæµï¼Œå‰ç«¯åˆ©ç”¨ <code>blob</code> æ¥å¤„ç†ä¸‹è½½ã€‚</p> <p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸‹ï¼š</p> <ul><li><code>xlsx</code> è½¬ä¸ºè¡¨æ ¼çš„æ—¶å€™æ•°æ®çš„æ ¼å¼åº”è¯¥æ˜¯ <code>[['æ ‡é¢˜', 'ç”Ÿæ—¥', 'å¹´é¾„'],['title', 'birthday', 'age'],['title', 'birthday', 'age']...]</code>ï¼Œè¿™ä¸ªæ•°ç»„çš„ç¬¬ä¸€é¡¹å°±æ˜¯ <code>excel</code> çš„è¡¨æ ¼è¡¨å¤´ï¼Œå‰©ä¸‹çš„é¡¹ç›®æ˜¯è¯·æ±‚å›æ¥ <code>json</code> æ•°æ®çš„æ¯ä¸€ä¸ªéœ€è¦å¯¼å‡ºçš„é¡¹ã€‚</li></ul> <p>æˆ‘ä»¬ä¼ªä»£ç æ¥æ¼”ç¤ºä¸€ä¸‹ï¼š</p> <h3 id="node-å±‚"><a href="#node-å±‚" class="header-anchor">#</a> <code>node</code> å±‚</h3> <ul><li>ä¸»é€»è¾‘ï¼Œå› ä¸ºæˆ‘ä»¬ç”¨çš„æ˜¯ <code>thinkjs</code>ï¼Œæ‰€ä»¥æŒ‰ç…§ <code>think</code> çš„æ–¹å¼å¤„ç†å‚æ•°ã€‚</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">XLSX</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">downloadExcelAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token constant">EXCEL_TITLE</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;æ ‡é¢˜&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ç”Ÿæ—¥&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;å¹´é¾„&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// å®é™…æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å°±åº”è¯¥æ˜¯è¿™æ ·è·å–æ•°æ®</span>
  <span class="token comment">// const params = this.post() // è·å–bodyå‚æ•°</span>
  <span class="token comment">// const serviceUrl = this.get('serviceUrl') // è·å–getè¯·æ±‚å‚æ•°çš„å®é™…æœåŠ¡ç«¯åœ°å€</span>
  <span class="token comment">// const data = await Promise.all(mapRequestList(serviceUrl, params))</span>

  <span class="token comment">// è¿™é‡Œå¯èƒ½éœ€è¦é¢å¤–åšä¸€ä¸ªå¤„ç†ï¼Œdataè¿”å›çš„æ•°æ®æ ¼å¼æˆ–è®¸æ˜¯[[],[],[]]</span>
  <span class="token comment">// æˆ‘ä»¬éœ€è¦å¤„ç†æ¯ä¸€é¡¹ï¼Œpromise.allæ¥å—çš„æ•°æ®åº”è¯¥è¢«æ‰“å¹³</span>
  <span class="token comment">// å³data.flat(2) æˆ–è€… flatten(data)</span>

  <span class="token comment">// è¿™æ˜¯ä¸€ä¸ªæˆ‘ä»¬å…ˆå‡†å¤‡çš„å‡æ•°æ®</span>
  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;ç¬¬ä¸€ä¸ª&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">birthday</span><span class="token operator">:</span> <span class="token string">&quot;1999/01/03&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">&quot;23&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;ç¬¬äºŒä¸ª&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">birthday</span><span class="token operator">:</span> <span class="token string">&quot;2000/12/03&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token string">&quot;20&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> xlsxData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token punctuation">[</span>element<span class="token punctuation">.</span>title<span class="token punctuation">,</span> element<span class="token punctuation">.</span>birthday<span class="token punctuation">,</span> element<span class="token punctuation">.</span>age<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// è¿™é‡Œä¸ä½¿ç”¨pushæ˜¯ä¸ºäº†é¿å…æ•°æ®é¡ºåºé—®é¢˜</span>
    xlsxData<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  xlsxData <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">EXCEL_TITLE</span><span class="token punctuation">,</span> <span class="token operator">...</span>xlsxData<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">// æœ€åæˆ‘ä»¬è¦ç”Ÿæˆçš„è¡¨æ ¼è‚¯å®šæ˜¯è¿™æ ·çš„ä¸€ä¸ªæ•°æ®ç»“æ„ xlsxData å†è°ƒç”¨xlsxçš„api</span>
  <span class="token keyword">const</span> sheet <span class="token operator">=</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">aoa_to_sheet</span><span class="token punctuation">(</span>xlsxData<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// è·å–ä¸Šä¸‹æ–‡</span>
  <span class="token keyword">const</span> ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">;</span>

  <span class="token comment">// excel è½¬ node æ–‡ä»¶æµ</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">sheetToBuffer</span><span class="token punctuation">(</span>sheet<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// è®¾ç½® excel ä¸‹è½½çš„å“åº” Content-Type</span>
  <span class="token keyword">const</span> mimeType <span class="token operator">=</span>
    <span class="token string">&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">,</span> mimeType<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> result<span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿçš„æ•°æ®ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªå·²ç»å®šä¹‰å¥½çš„æ•°ç»„ <code>data</code>ï¼Œä½†æ˜¯ç°å®æƒ…å†µè‚¯å®šæ˜¯éœ€è¦å‘æœåŠ¡ç«¯å‘è¯·æ±‚è·å–æ•°æ®ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥åˆ©ç”¨ <code>Promise.all</code> å¤„ç†ã€‚å‡è®¾åˆ—è¡¨é¡µä¸­éœ€è¦å¯¼å‡ºæ•°æ® <code>10000</code> æ¡ï¼Œæ¯æ¬¡è¯·æ±‚ <code>500</code> æ¡ï¼Œéœ€è¦è¯·æ±‚ <code>20</code> æ¬¡ï¼Œæ¯æ¬¡åˆ†é¡µåç§»é‡å¢åŠ  <code>1</code>ï¼Œæ‰€ä»¥å…·ä½“çš„å®ç°ä¼ªä»£ç ï¼š</p> <ul><li><code>baseAxiosRequest</code> æœ€åŸºæœ¬çš„å•å…ƒæ¥å£è¯·æ±‚æ•°æ®çš„æ–¹æ³•ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;axios&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™é‡Œæ¥å—ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªè¯·æ±‚åœ°å€ä¸€ä¸ªè¯·æ±‚å‚æ•°ï¼Œè¯·æ±‚å°±æ˜¯ä¸€äº›åˆ†é¡µã€åç§»é‡ä»¥åŠåˆ«çš„å‚æ•°ç­‰ã€‚</span>
<span class="token keyword">function</span> <span class="token function">baseAxiosRequest</span><span class="token punctuation">(</span><span class="token parameter">serviceUrl<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> axios
      <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>serviceUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        params<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿™é‡Œæ ¹æ®è‡ªå·±æœåŠ¡ç«¯å“åº”æ ¼å¼ï¼Œå°†è·å–çš„list[]æ•°æ®ä»å½“å‰å‡½æ•°è¿”å›å‡ºå»</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> desc<span class="token punctuation">,</span> errorno<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorno <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// è¿™é‡Œ return æˆ–è€… resolve çš„åŒºåˆ«å¯ä»¥çœ‹ä¸Šä¸€ç¯‡æ•´ç†</span>
          <span class="token comment">// [Promise ä¸­çš„ resolve å’Œ return çš„ç–‘æƒ‘](https://tennesseesunshine.github.io/2021/06/13/promiseResolveReturn/)</span>
          <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>sheetToBuffer</code> å°†æ•°æ®è½¬ä¸º <code>buffer</code> æµæ•°æ®</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sheetToBuffer</span><span class="token punctuation">(</span><span class="token parameter">sheetData<span class="token punctuation">,</span> sheetName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sheetName <span class="token operator">=</span> sheetName <span class="token operator">||</span> <span class="token string">&quot;sheet1&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> workbook <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">SheetNames</span><span class="token operator">:</span> <span class="token punctuation">[</span>sheetName<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Sheets</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  workbook<span class="token punctuation">.</span>Sheets<span class="token punctuation">[</span>sheetName<span class="token punctuation">]</span> <span class="token operator">=</span> sheetData<span class="token punctuation">;</span>

  <span class="token comment">// excelçš„é…ç½®é¡¹</span>
  <span class="token keyword">let</span> wopts <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">bookType</span><span class="token operator">:</span> <span class="token string">&quot;xlsx&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;buffer&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>workbook<span class="token punctuation">,</span> wopts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>flatten</code> æ‰“å¹³æ•°ç»„</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token operator">...</span>pre<span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">flatten</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">[</span>cur<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å› ä¸ºè¦ä½¿ç”¨ <code>Promise.all</code> æ‰€ä»¥éœ€è¦ä¸€ä¸ª <code>map</code> æ–¹æ³•å°†æ‰€æœ‰çš„è¯·æ±‚éƒ½è½¬ä¸ºå…¶å¯ä»¥æ¥å—çš„å‚æ•°å½¢å¼ï¼Œå¦‚ä¸‹ <code>mapRequestList</code>ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">mapRequestList</span><span class="token punctuation">(</span><span class="token parameter">serviceUrl<span class="token punctuation">,</span> params</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// æ¯é¡µè¯·æ±‚æ•°é‡</span>
  <span class="token keyword">const</span> pageSize <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
  <span class="token comment">// æ€»åˆ†é¡µé‡ï¼Œä¹Ÿå°±æ˜¯ä¸€å…±å‘èµ·çš„è¯·æ±‚æ•°</span>
  <span class="token keyword">const</span> pageNumber <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
  <span class="token comment">// ç”¨äºå­˜å‚¨promiseçš„æ•°ç»„</span>
  <span class="token keyword">let</span> requestArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pageNumber<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    requestArr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> att <span class="token operator">=</span> requestArr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pageNumber</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>params<span class="token punctuation">,</span> pageSize<span class="token punctuation">,</span> pageNumber <span class="token punctuation">}</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;å‘èµ·ç¬¬&quot;</span> <span class="token operator">+</span> pageNumber <span class="token operator">+</span> <span class="token string">&quot;ä¸ªè¯·æ±‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">baseAxiosRequest</span><span class="token punctuation">(</span>serviceUrl<span class="token punctuation">,</span> opts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> att<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æœåŠ¡ç«¯çš„åŠŸèƒ½åŸºæœ¬ä¸Šç®—æ˜¯å®Œæˆäº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®¢æˆ·ç«¯æ€ä¹ˆç”¨ã€‚</p> <h3 id="web-è¯·æ±‚"><a href="#web-è¯·æ±‚" class="header-anchor">#</a> <code>web</code> è¯·æ±‚</h3> <p>è¿™é‡Œå› ä¸ºæˆ‘ä»¬ç”¨çš„ <code>umi-requestï¼Œaxios</code> ç¨å¾®æœ‰ä¸€ç‚¹ä¸ä¸€æ ·ï¼Œä¸‹æ–‡ä¼šæœ‰è¯´æ˜</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> request <span class="token keyword">from</span> <span class="token string">&quot;umi-request&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">handleExcelExport</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// è¿™é‡Œçš„urlæ‹¼æ¥ï¼Œéœ€è¦è¯·æ±‚åˆ°nodeçš„controller</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/api/app/toolName/downloadExcel/downloadExcel?serviceUrl=http://yourExportListHost.com/list</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

  <span class="token function">request</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">300000</span><span class="token punctuation">,</span> <span class="token comment">// è®¾ç½®è¶…æ—¶è™½ç„¶5åˆ†é’Ÿä½†æ˜¯åæ¥è¿˜æ˜¯è¶…æ—¶</span>
    <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">&quot;blob&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>response<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> elink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      elink<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fileName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.xlsx</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      elink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>

      <span class="token comment">// åˆ›å»ºblob urlä¸‹è½½</span>
      elink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span><span class="token punctuation">;</span>
      elink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// å¿…é¡»é‡Šæ”¾ URL å¯¹è±¡</span>
      <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>elink<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// axiosè¿™é‡Œçš„è¯æœ‰ä¸€ç‚¹ç»†å¾®çš„åŒºåˆ«ï¼Œæ˜¯åœ¨æ¥å£è¿”å›å“åº”ä¹‹åï¼Œè·å–æ•°æ®è½¬ä¸ºblobçš„æ—¶å€™</span>
  <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;post&quot;</span><span class="token punctuation">,</span>
    url<span class="token punctuation">,</span>
    data<span class="token punctuation">,</span>
    <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">&quot;blob&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// åŒºåˆ«åœ¨è¿™é‡Œ</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> response<span class="token punctuation">;</span>
    <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>data<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>åœ¨æˆ‘å¯¼å‡ºçš„æ—¶å€™å‘ç°å‡ ä¸ªé—®é¢˜ï¼š</p> <ul><li>ç¬¬ä¸€ï¼šæ¥å£å“åº”æ—¶é—´<code>æ¯”è¾ƒæ…¢</code>ã€‚å•æ¬¡æŸ¥è¯¢å¯èƒ½ä¼šåˆ° <code>4-7s</code>ï¼Œè¿™æ˜¯å› ä¸ºæ¥å£æœ¬èº«é—®é¢˜ï¼Œæ•°æ®ä½“é‡å¤ªå¤§ï¼ŒæŸ¥è¯¢è€—æ—¶é•¿ã€‚</li> <li>ç¬¬äºŒï¼šæ•°æ®åœ¨ <code>node</code> å±‚å°† <code>json</code> è½¬ä¸ºæµçš„æ—¶å€™å¯èƒ½ä¼šæ¯”è¾ƒè€—ç®—åŠ›å’Œå†…å­˜ï¼Œæˆ‘ä»¬ç°åœ¨æ‰€æœ‰çš„å‰ç«¯éƒ½ç”¨åŒä¸€ä¸ª <code>node</code> æœåŠ¡ï¼Œä¸€æ—¦è¿™é‡Œå•çº¿ç¨‹è€—æ—¶æ¯”è¾ƒä¹…çš„è¯ï¼Œå¯èƒ½ä¼šå› ä¸ºä¸€ç³»åˆ—é—®é¢˜å½±å“åˆ°åç»­çš„å…¶ä»–å·¥å…·çš„æ¥å£è½¬å‘ï¼Œå½±å“åˆ°å…¶ä»–å·¥å…·çš„ç¨³å®šã€‚</li> <li>ç¬¬ä¸‰ï¼šè¶…æ—¶ä¸¥é‡ï¼ŒåŸºæœ¬æ— æ³•åœ¨è¶…æ—¶ä¹‹å‰æˆåŠŸå¯¼å‡º <code>10000</code> æ¡æ•°æ®ã€‚</li></ul> <p>åæ¥åœ¨æƒè¡¡åˆ©å¼Šä¹‹åï¼Œå› ä¸ºæ•°æ®åªæ˜¯ç”¨æ¥çœ‹ï¼Œä¸ä¼šè®¡ç®—ä»¥åŠåˆ«çš„æ“ä½œï¼Œé‡‡ç”¨åœ¨å®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯æµè§ˆå™¨ä¸­å¯¼å‡º <code>csv</code> æ ¼å¼çš„æ•°æ®ï¼Œåˆ©ç”¨ <code>excel</code> æ‰“å¼€æ˜¯å¯ä»¥æ»¡è¶³çš„ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†ç¬¬äºŒä¸­æ–¹æ¡ˆã€‚</p> <h2 id="çº¯å‰ç«¯æ–¹æ¡ˆ"><a href="#çº¯å‰ç«¯æ–¹æ¡ˆ" class="header-anchor">#</a> çº¯å‰ç«¯æ–¹æ¡ˆ</h2> <p>æµè§ˆå™¨åˆ†ç‰‡è¯·æ±‚æ¥å£ï¼Œå°†æ•°æ®ç»„è£…ä¸º <code>csv</code> å¯¼å‡ºï¼Œè¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯é‡‡ç”¨æ–¹æ¡ˆä¸€ä¸­çš„å‡æ•°æ®ä½œä¸ºæ¼”ç¤º</p> <ul><li><code>exportJsonToCSV</code> æ–‡ä»¶ï¼Œä¸»ä½“å¯¼å‡ºæ–¹æ³•ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// åœ¨æ¥å£å“åº”å®Œæˆä¹‹åï¼Œå°†ç¬¬iä¸ªç´¢å¼•å­˜è¿›å»ï¼Œè®¡ç®—å¯¼å‡ºè¿›åº¦</span>
<span class="token keyword">let</span> percentArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pageSize <span class="token operator">=</span> <span class="token number">250</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> maxReqCount <span class="token operator">=</span> <span class="token number">40</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">exportCsv</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">total<span class="token punctuation">,</span> queryParams<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>total<span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token string">&quot;æ— æ•°æ®&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> maxLen <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>total <span class="token operator">/</span> pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// åšæœ€å¤§åˆ†ç‰‡å¤„ç†</span>
    <span class="token comment">// æ­£å¸¸æƒ…å†µä¸‹çš„ åˆ†ç‰‡è¯·æ±‚éƒ½æ˜¯å¯é¢„çŸ¥çš„ï¼Œå¦‚æœ ä½ çš„promise.all æ¥å—çš„æ•°ç»„</span>
    <span class="token comment">// æ˜¯ä½ æ— æ³•é¢„æ–™çš„é•¿åº¦ï¼Œä¸€å®šæ˜¯éœ€è¦limitæœ€å¤§å¹¶å‘é‡çš„ï¼Œä¸ç„¶å¯èƒ½ä¼šé€ æˆè°ƒç”¨æ ˆæº¢å‡º</span>
    <span class="token comment">// é™åˆ¶æœ€å¤§å¹¶å‘è¯·æ±‚æ•° å¯ä»¥åˆ©ç”¨p-limitç­‰ä¸‰æ–¹åº“</span>
    <span class="token keyword">const</span> pageNumber <span class="token operator">=</span> maxLen <span class="token operator">&gt;=</span> maxReqCount <span class="token operator">?</span> maxReqCount <span class="token operator">:</span> maxLen<span class="token punctuation">;</span>

    <span class="token comment">// å­˜å‚¨ CSV æ•°æ®</span>
    <span class="token comment">// æ³¨æ„ csvçš„å­˜å‚¨æ˜¯ä»¥è‹±æ–‡,åˆ†å‰²çš„ï¼Œæ‰€ä»¥é›†åˆç±»çš„æ•°æ®ä¸è¦ç”¨è‹±æ–‡é€—å·åˆ†å‰²</span>
    <span class="token comment">// æ¯ä¸€ä¸ª,ä¹‹å‰çš„æ•°æ®åœ¨excelé‡Œæ‰“å¼€å°±æ˜¯ä¸€ä¸ªå•å…ƒæ ¼</span>
    <span class="token comment">// æ‰€ä»¥ä¸€æ—¦è¯†åˆ«å‡ºæ¥è‹±æ–‡é€—å·ï¼Œå°±ä¼šåœ¨excelé‡Œæ‰“å¼€å¤šä¸€ä¸ªè¡¨æ ¼ï¼Œæ‰€ä»¥æœ€å¥½è½¬ä¸ºã€</span>
    <span class="token keyword">let</span> cvsArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">const</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ›å»ºæŒ‡å®šä¸ªæ•°çš„æ¥å£æ•°æ®</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
          <span class="token function">requestMapList</span><span class="token punctuation">(</span>queryParams<span class="token punctuation">,</span> pageNumber<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// dataæ˜¯ä¸€ä¸ª[[],[],[]]æ ¼å¼çš„æ•°æ®ï¼Œæ‹å¹³ä¸€ä¸‹å¤„ç†</span>
        <span class="token comment">// æ ¼å¼åŒ–ä¸º CSV å­—ç¬¦ä¸²</span>
        <span class="token comment">// csvæ¥å—çš„æ ¼å¼æ˜¯ [0:'a,b,c', 1: 'a1,b1,c1', 2: 'a2,b2,c2']</span>
        data<span class="token operator">?.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">row<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> newRow <span class="token operator">=</span> <span class="token punctuation">[</span>element<span class="token punctuation">.</span>title<span class="token punctuation">,</span> element<span class="token punctuation">.</span>birthday<span class="token punctuation">,</span> element<span class="token punctuation">.</span>age<span class="token punctuation">]</span><span class="token punctuation">;</span>

          <span class="token comment">// å°†ä¸Šä¸€æ­¥æ•°æ®å­˜èµ·æ¥</span>
          cvsArray<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> newRow<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºè¡¨å¤´ è¿™é‡Œé€‰æ‹©åœ¨æœ€åå†åŠ è¡¨å¤´æ˜¯ä¸ºäº†é¿å… percentArr å­˜æ•°æ®çš„æ—¶å€™å¹²æ‰°</span>
        cvsArray<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token constant">EXCEL_TITLE</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// é€‚å½“æš‚åœï¼Œé¿å…é¡µé¢æ— æ³•æ‰§è¡Œæ¸²æŸ“</span>
        <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">_resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    task
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// åˆ›å»ºblob</span>
          <span class="token keyword">const</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">0xfeff</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">...</span>cvsArray<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;text/plain;charset=utf-8&quot;</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token function">createATagTodownload</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// å®Œæˆåå°†è¿›åº¦æ•°æ®åˆå§‹åŒ–</span>
          percentArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>baseRequestData</code> åŸºç¡€å•å…ƒè¯·æ±‚æ¥å£çš„æ–¹æ³•ï¼š</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">baseRequestData</span><span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> index<span class="token punctuation">,</span> pageNumber<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token constant">SERVICEURL</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> params <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ ¹æ®æ¥å£å“åº”æ ¼å¼æ¥å¤„ç†</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> desc<span class="token punctuation">,</span> errorno<span class="token punctuation">,</span> data <span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorno <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// è¯·æ±‚å®Œæˆä¸€æ¬¡å­˜å‚¨ä¸€ä¸ª</span>
          percentArr<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> index<span class="token punctuation">;</span>
          <span class="token keyword">const</span> percentLen <span class="token operator">=</span> percentArr<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>

          <span class="token comment">// è®¡ç®—å¯¼å‡ºè¿›åº¦</span>
          <span class="token keyword">const</span> percent <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>percentLen <span class="token operator">/</span> pageNumber<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// console.log('è¿›åº¦', percent, percentArr);</span>

          <span class="token comment">// å°†è®¡ç®—çš„æ•°æ®è¿”å›åˆ°é¡µé¢</span>
          callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>requestMapList</code> ç»„è£…è¯·æ±‚ä¸º <code>Promise</code> æ•°ç»„</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">requestMapList</span><span class="token punctuation">(</span><span class="token parameter">params<span class="token punctuation">,</span> pageNumber<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> requestMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span>pageNumber<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pn<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>params<span class="token punctuation">,</span> pageSize<span class="token punctuation">,</span> <span class="token literal-property property">pageNumber</span><span class="token operator">:</span> pn <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// console.log('å‘èµ·ç¬¬' + pn + 'ä¸ªè¯·æ±‚');</span>
      <span class="token keyword">return</span> <span class="token function">baseRequestData</span><span class="token punctuation">(</span>opts<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> pageNumber<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> requestMap<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>createATagTodownload</code> åˆ›å»º <code>a</code> æ ‡ç­¾åˆ©ç”¨ <code>blob</code> æ¥å¯¼å‡º</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createATagTodownload</span><span class="token punctuation">(</span><span class="token parameter">blob<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> elink <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elink<span class="token punctuation">.</span>download <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename <span class="token operator">||</span> <span class="token string">&quot;æ–‡ä»¶å¯¼å‡º&quot;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.csv</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    elink<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
    elink<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span><span class="token punctuation">;</span>
    elink<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">revokeObjectURL</span><span class="token punctuation">(</span>elink<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å¿…é¡»é‡Šæ”¾ URL å¯¹è±¡</span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>elink<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>é¡µé¢ä½¿ç”¨ï¼Œå±•ç¤ºå®æ—¶è¿›åº¦</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>loadingPercent<span class="token punctuation">,</span> setLoadingPercent<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">[</span>loadingMask<span class="token punctuation">,</span> setLoadingMask<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">handleExportFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// å¯¼å‡ºæŒ‰é’®ä½¿ç”¨</span>
  <span class="token function">setLoadingMask</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">exportCsv</span><span class="token punctuation">(</span>pagination<span class="token operator">?.</span>total<span class="token punctuation">,</span> queryParams<span class="token punctuation">,</span> filename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">percent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setLoadingPercent</span><span class="token punctuation">(</span>percent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setLoadingMask</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setLoadingPercent</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;err&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Modal</span></span>
  <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>æ•°æ®å¯¼å‡º(é»˜è®¤1wæ¡)è¿›åº¦<span class="token punctuation">&quot;</span></span>
  <span class="token attr-name">visible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loadingMask<span class="token punctuation">}</span></span>
  <span class="token attr-name">width</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">maskClosable</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">keyboard</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">destroyOnClose</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">footer</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token keyword">null</span><span class="token punctuation">}</span></span>
  <span class="token attr-name">closable</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">false</span><span class="token punctuation">}</span></span>
<span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token literal-property property">display</span><span class="token operator">:</span> <span class="token string">&quot;flex&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">justifyContent</span><span class="token operator">:</span> <span class="token string">&quot;center&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Progress</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>circle<span class="token punctuation">&quot;</span></span> <span class="token attr-name">percent</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>loadingPercent<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Modal</span></span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
</code></pre></div><p>å¯¼å‡º <code>csv</code> çš„æ ¼å¼ä¸ä¼šå‡ºç°è¶…æ—¶çš„é—®é¢˜ï¼Œ<code>10000</code> æ¡æ•°åŸºæœ¬ä¼šåœ¨ <code>40s</code> å·¦å³ï¼Œè¿™å…¶ä¸­æœ‰ä¸€å¤§éƒ¨åˆ†åŸå› æ˜¯å› ä¸ºæ¥å£å“åº”æ…¢ï¼Œå†å°±æ˜¯å› ä¸ºåŒä¸€åŸŸåï¼Œåœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚çš„æ—¶å€™ <code>chrome</code> ä¼šé™åˆ¶ <code>6</code> æ¡ï¼Œæ‰€ä»¥æ–¹æ¡ˆä¸­é‡‡ç”¨çš„å¯¼å‡ºé‡‡ç”¨è¯·æ±‚ <code>40</code> æ¬¡ï¼Œåç»­çš„è¯·æ±‚è‚¯å®šæ˜¯ä¼šè¢«æŒ‚èµ·ç­‰å¾…æ–°çš„å¯ç”¨è¿æ¥ï¼Œæ¯”è¾ƒè€—æ—¶ï¼Œå…·ä½“çš„å°±æ˜¯æµè§ˆå™¨ <code>network</code> ä¸­çš„ <code>Timing</code> çš„ <code>Connection Start</code> çš„ <code>Stalled</code> æ—¶é—´è¶Šå¾€åè¶Šé•¿ã€‚</p> <p>æ‰€ä»¥æ–¹æ¡ˆäºŒçš„è¯ç›®å‰æ˜¯æ¯”è¾ƒå¯è¡Œçš„ä¸€ç§è§£å†³é—®é¢˜çš„å¥—è·¯ã€‚</p> <p>å¯¹äº <code>Stalled</code>æ—¶é—´é—®é¢˜ï¼Œè¯·æ±‚é™æ€èµ„æºï¼Œå¯ä»¥é€šè¿‡åŸŸååˆ†ç‰‡æ¥æ‹†åšåˆ°å¤šè¯·æ±‚ï¼Œä½†æ˜¯å¯¹äºæ¥å£æ–¹é¢çš„è¿™ç§æƒ…å†µç›®å‰è¿˜ä¸çŸ¥é“æ€ä¹ˆè§£å†³ã€‚</p> <p>ä¸€äº›å…³äº <code>stalled</code> æ—¶é—´è¿‡é•¿çš„æ–‡ç« </p> <ul><li><a href="https://blog.csdn.net/tianhouquan/article/details/78803601" target="_blank" rel="noopener noreferrer">å…³äºè¯·æ±‚è¢«æŒ‚èµ·é¡µé¢åŠ è½½ç¼“æ…¢é—®é¢˜çš„è¿½æŸ¥ï¼ˆstalled æ—¶é—´è¿‡é•¿ï¼‰<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/WGH100817/article/details/101723517?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.baidujs&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.baidujs" target="_blank" rel="noopener noreferrer">å…³äºå¿ƒè·³ ajax è¯·æ±‚ pending çŠ¶æ€ï¼ˆè¢«æŒ‚èµ·ï¼‰ï¼Œstalled æ—¶é—´è¿‡é•¿çš„é—®é¢˜<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://kb.cnblogs.com/page/513237/" target="_blank" rel="noopener noreferrer">å…³äºè¯·æ±‚è¢«æŒ‚èµ·é¡µé¢åŠ è½½ç¼“æ…¢é—®é¢˜çš„è¿½æŸ¥<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°:</span> <span class="time">2/12/2023, 7:42:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/notes/browser/http2-notes.html" class="prev">
        http2.0 å­¦ä¹ ç¬”è®°
      </a></span> <span class="next"><a href="/blog/notes/browser/web-performance.html">
        éƒ¨åˆ† web æ€§èƒ½ä¼˜åŒ–æ¸…å• ğŸ§¾
      </a>
      â†’
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.f8d55777.js" defer></script><script src="/blog/assets/js/2.9875f188.js" defer></script><script src="/blog/assets/js/16.76fb416d.js" defer></script>
  </body>
</html>
