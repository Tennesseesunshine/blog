<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ä¸ºåšå®¢å¢åŠ PWAåŠŸèƒ½ | æŸå–µå–µ</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="ç®€å•è®°å½•ã€å­¦ä¹ ç¬”è®°">
    
    <link rel="preload" href="/blog/assets/css/0.styles.144fa934.css" as="style"><link rel="preload" href="/blog/assets/js/app.f8d55777.js" as="script"><link rel="preload" href="/blog/assets/js/2.9875f188.js" as="script"><link rel="preload" href="/blog/assets/js/18.eac3edd8.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.12a746c0.js"><link rel="prefetch" href="/blog/assets/js/11.e589b28a.js"><link rel="prefetch" href="/blog/assets/js/12.d7f69a0d.js"><link rel="prefetch" href="/blog/assets/js/13.78ef516b.js"><link rel="prefetch" href="/blog/assets/js/14.890c0bbf.js"><link rel="prefetch" href="/blog/assets/js/15.2ded1311.js"><link rel="prefetch" href="/blog/assets/js/16.76fb416d.js"><link rel="prefetch" href="/blog/assets/js/17.9b70c6a6.js"><link rel="prefetch" href="/blog/assets/js/19.15ea688e.js"><link rel="prefetch" href="/blog/assets/js/20.f4f2564b.js"><link rel="prefetch" href="/blog/assets/js/21.c8cf4362.js"><link rel="prefetch" href="/blog/assets/js/22.56e6986d.js"><link rel="prefetch" href="/blog/assets/js/23.a5565786.js"><link rel="prefetch" href="/blog/assets/js/24.ef7d6995.js"><link rel="prefetch" href="/blog/assets/js/25.a9c02ac5.js"><link rel="prefetch" href="/blog/assets/js/26.77995ffd.js"><link rel="prefetch" href="/blog/assets/js/27.0373c9dc.js"><link rel="prefetch" href="/blog/assets/js/28.186384fd.js"><link rel="prefetch" href="/blog/assets/js/29.fb7b2b82.js"><link rel="prefetch" href="/blog/assets/js/3.446fcee1.js"><link rel="prefetch" href="/blog/assets/js/30.65274b10.js"><link rel="prefetch" href="/blog/assets/js/31.55b2efaa.js"><link rel="prefetch" href="/blog/assets/js/32.977599e7.js"><link rel="prefetch" href="/blog/assets/js/33.2ba845ff.js"><link rel="prefetch" href="/blog/assets/js/34.4e23bcaf.js"><link rel="prefetch" href="/blog/assets/js/35.b4dbff7c.js"><link rel="prefetch" href="/blog/assets/js/36.892623ef.js"><link rel="prefetch" href="/blog/assets/js/37.20db8c90.js"><link rel="prefetch" href="/blog/assets/js/38.f65dc72f.js"><link rel="prefetch" href="/blog/assets/js/39.95de0fa6.js"><link rel="prefetch" href="/blog/assets/js/4.48c34b70.js"><link rel="prefetch" href="/blog/assets/js/40.72a20d87.js"><link rel="prefetch" href="/blog/assets/js/41.68381aaa.js"><link rel="prefetch" href="/blog/assets/js/42.d4e1858e.js"><link rel="prefetch" href="/blog/assets/js/43.7380438e.js"><link rel="prefetch" href="/blog/assets/js/44.3344524d.js"><link rel="prefetch" href="/blog/assets/js/45.68e0ee32.js"><link rel="prefetch" href="/blog/assets/js/46.8f702e0b.js"><link rel="prefetch" href="/blog/assets/js/47.988df742.js"><link rel="prefetch" href="/blog/assets/js/5.b6391433.js"><link rel="prefetch" href="/blog/assets/js/6.66f56766.js"><link rel="prefetch" href="/blog/assets/js/7.b9c34bfd.js"><link rel="prefetch" href="/blog/assets/js/8.47ce4284.js"><link rel="prefetch" href="/blog/assets/js/9.c9ac39cc.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.144fa934.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/assets/images/icon.jpeg" alt="æŸå–µå–µ" class="logo"> <span class="site-name can-hide">æŸå–µå–µ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¬”è®°" class="dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¬”è®°" class="mobile-dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/notes/linux/shell-export-var-to-nodejs.html" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/vue/concis-event-bus.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/react/call-child-component-method.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/javascript/promise-resolve-and-return.html" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/network/" class="nav-link">
  ç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/browser/anchor-setting.html" class="nav-link">
  æµè§ˆå™¨ç›¸å…³
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="mobile-dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/design/offline/" class="nav-link">
  ç¦»çº¿åŒ…
</a></li><li class="dropdown-item"><!----> <a href="/blog/design/devops/gitlab-ci.html" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="mobile-dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tools/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/charles/" class="nav-link">
  charles
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/github/github-actions.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/webpack/md-to-html-loader.html" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Tennesseesunshine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  é¦–é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="ç¬”è®°" class="dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow down"></span></button> <button type="button" aria-label="ç¬”è®°" class="mobile-dropdown-title"><span class="title">ç¬”è®°</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/notes/linux/shell-export-var-to-nodejs.html" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/vue/concis-event-bus.html" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/react/call-child-component-method.html" class="nav-link">
  React
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/javascript/promise-resolve-and-return.html" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/network/" class="nav-link">
  ç½‘ç»œ
</a></li><li class="dropdown-item"><!----> <a href="/blog/notes/browser/anchor-setting.html" class="nav-link">
  æµè§ˆå™¨ç›¸å…³
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ" class="mobile-dropdown-title"><span class="title">å·¥ç¨‹æ•ˆç‡ã€è®¾è®¡æ–¹æ¡ˆ</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/design/offline/" class="nav-link">
  ç¦»çº¿åŒ…
</a></li><li class="dropdown-item"><!----> <a href="/blog/design/devops/gitlab-ci.html" class="nav-link">
  DevOps
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow down"></span></button> <button type="button" aria-label="å·¥å…·ä½¿ç”¨" class="mobile-dropdown-title"><span class="title">å·¥å…·ä½¿ç”¨</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/tools/vscode/" class="nav-link">
  vscode
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/charles/" class="nav-link">
  charles
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/github/github-actions.html" class="nav-link">
  github
</a></li><li class="dropdown-item"><!----> <a href="/blog/tools/webpack/md-to-html-loader.html" class="nav-link">
  webpack
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/Tennesseesunshine" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/notes/browser/anchor-setting.html" class="sidebar-link">è®¾ç½®é”šç‚¹</a></li><li><a href="/blog/notes/browser/browser-download.html" class="sidebar-link">æµè§ˆå™¨ä¸‹è½½æ–¹æ³•</a></li><li><a href="/blog/notes/browser/event-loop.html" class="sidebar-link">äº‹ä»¶å¾ªç¯</a></li><li><a href="/blog/notes/browser/http-cache.html" class="sidebar-link">HTTP ç¼“å­˜æ¢ç©¶</a></li><li><a href="/blog/notes/browser/http2-notes.html" class="sidebar-link">http2.0 å­¦ä¹ ç¬”è®°</a></li><li><a href="/blog/notes/browser/web-browser-export-file.html" class="sidebar-link">å‰ç«¯æ‰¹é‡å¯¼å‡ºæ¥å£æ•°æ®æ–¹æ¡ˆ</a></li><li><a href="/blog/notes/browser/web-performance.html" class="sidebar-link">éƒ¨åˆ† web æ€§èƒ½ä¼˜åŒ–æ¸…å• ğŸ§¾</a></li><li><a href="/blog/notes/browser/website-realize-pwa.html" aria-current="page" class="active sidebar-link">ä¸ºåšå®¢å¢åŠ PWAåŠŸèƒ½</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#æ¦‚è§ˆ" class="sidebar-link">æ¦‚è§ˆ</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#workbox" class="sidebar-link">workbox</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#app-manifest" class="sidebar-link">App Manifest</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#service-worker" class="sidebar-link">Service Worker</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#è¯¦ç»†æµç¨‹" class="sidebar-link">è¯¦ç»†æµç¨‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#å®‰è£…ä¾èµ–" class="sidebar-link">å®‰è£…ä¾èµ–</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#æ–°å»ºæ–‡ä»¶" class="sidebar-link">æ–°å»ºæ–‡ä»¶</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#æ‰§è¡Œ" class="sidebar-link">æ‰§è¡Œ</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#ç¼–è¾‘æ¨¡ç‰ˆ" class="sidebar-link">ç¼–è¾‘æ¨¡ç‰ˆ</a></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼" class="sidebar-link">è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog/notes/browser/website-realize-pwa.html#å‚è€ƒ" class="sidebar-link">å‚è€ƒ</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="header-anchor">#</a> æ¦‚è§ˆ</h2> <p>å®ç°çš„PWAæ”¯æŒçš„åšå®¢ï¼š<a href="https://tennesseesunshine.github.io/" target="_blank" rel="noopener noreferrer">https://tennesseesunshine.github.io/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>å¾ˆæ—©ä¹‹å‰å°±äº†è§£è¿‡ <code>Service Worker</code> å†åˆ°åæ¥çš„ <code>PWA</code>ï¼Œå¹¶ä¸”ä¸€ç›´æƒ³å°è¯•ä¸ºç½‘ç«™å¢åŠ ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œå°¤å…¶æ˜¯ <code>PWA</code> çš„å¯ä»¥å°†ç½‘ç«™å®‰è£…åœ¨æ¡Œé¢è¿™ä¸€ä¸ªåŠŸèƒ½éå¸¸å¸å¼•æˆ‘ï¼Œè€Œæ­£å¥½ <code>github-pages</code> æ˜¯éƒ¨ç½²åœ¨ <code>https</code> ä¸Šï¼Œæ‰€ä»¥ç”¨ <code>workbox</code> ç›´æ¥æ”¹é€ äº†åŸºäº <code>github-pages</code> çš„ <code>hexo</code> ä¸ªäººåšå®¢ã€‚</p> <p><code>PWA</code> çš„å¥½å¤„è‡ªç„¶ä¸ç”¨å¤šè¯´ï¼Œå…¶èƒ½å‘é€å¿«æ·æ–¹å¼åˆ°æ¡Œé¢ä¸Šè¿™ä¸€åŠŸèƒ½ï¼Œå°†ç”¨æˆ·çš„æ“ä½œé“¾ç”±ä¹‹å‰çš„æœ€é•¿çš„ æ‰“å¼€æµè§ˆå™¨-&gt;è¾“å…¥ç½‘å€[é¢ä¸´æ•²é”™çš„å°´å°¬åœ°æ­¥]-&gt;æ¸²æŸ“ç›®æ ‡ç½‘ç«™ æˆ–è€…æœ€çŸ­çš„ æ‰“å¼€æµè§ˆå™¨-&gt;é€‰æ‹©ä¹¦ç­¾åŠ è½½ç›®æ ‡ç½‘ç«™ï¼Œä¼˜åŒ–åˆ°äº†åªæœ‰ç‚¹å‡»å‘é€åˆ°æ¡Œé¢çš„å¿«æ·æ–¹å¼ç›´æ¥æ‰“å¼€ç½‘ç«™è¿™ä¸€æ­¥ï¼Œå³ä¸€è§¦å³è¾¾ï¼Œè€Œä¸”æ²¡æœ‰æµè§ˆå™¨èœå•æ ã€åœ°å€æ çš„å½±å“ï¼Œå†é…åˆ <code>Service Worker</code> å®ç°çš„åŠ é€Ÿå’Œç¦»çº¿è®¿é—®ï¼Œè¿™å¯è°“è¯´æ˜¯å¤§å¤§æé«˜äº†ç”¨æˆ·çš„ç²˜æ€§ï¼Œéå¸¸åˆ©äºç½‘ç«™ç•™å­˜ã€‚</p> <p><code>PWA</code> ä¸æ˜¯ç‰¹æŒ‡æŸä¸€é¡¹æŠ€æœ¯ï¼Œè€Œæ˜¯åº”ç”¨äº†å¤šé¡¹æŠ€æœ¯çš„ <code>Web App</code>ã€‚å…¶æ ¸å¿ƒæŠ€æœ¯åŒ…æ‹¬ App Manifestã€<code>Service Worker</code>ã€<code>Web Push</code> ç­‰ã€‚æˆ‘ä»¬èƒ½å¤Ÿå‘ç°ä¸€äº›ä¸»æµç½‘ç«™ä¾‹å¦‚ <code>vue</code> çš„å®˜ç½‘ã€æ˜Ÿå·´å…‹ <code>web</code> ç‰ˆéƒ½æ˜¯æ”¯æŒ <code>PWA</code> çš„ã€‚</p> <h2 id="workbox"><a href="#workbox" class="header-anchor">#</a> <code>workbox</code></h2> <p><code>workbox</code> æ˜¯ <code>GoogleChrome</code> å›¢é˜Ÿæ¨å‡ºçš„ä¸€å¥— <code>Web App</code> é™æ€èµ„æºå’Œè¯·æ±‚ç»“æœçš„æœ¬åœ°å­˜å‚¨çš„è§£å†³æ–¹æ¡ˆï¼Œè¯¥è§£å†³æ–¹æ¡ˆåŒ…å«ä¸€äº› Js åº“å’Œæ„å»ºå·¥å…·ï¼Œåœ¨ <code>Chrome Submit 2017</code> ä¸Šé¦–æ¬¡éš†é‡é¢ä¸–ã€‚è€Œåœ¨ <code>workbox</code> èƒŒååˆ™æ˜¯ <code>Service Worker</code> å’Œ <code>Cache API</code> ç­‰æŠ€æœ¯å’Œæ ‡å‡†åœ¨é©±åŠ¨ã€‚</p> <h2 id="app-manifest"><a href="#app-manifest" class="header-anchor">#</a> <code>App Manifest</code></h2> <p>ä¸€ä¸ª <code>json</code> çš„æ–‡ä»¶ï¼Œé€šè¿‡ä¸€ç³»åˆ—é…ç½®ï¼Œå°±å¯ä»¥æŠŠä¸€ä¸ª <code>PWA</code> åƒ <code>APP</code> ä¸€æ ·ï¼Œæ·»åŠ ä¸€ä¸ªå›¾æ ‡åˆ°æ‰‹æœºå±å¹•ä¸Šï¼Œç‚¹å‡»å›¾æ ‡å³å¯æ‰“å¼€ç«™ç‚¹ã€‚</p> <h2 id="service-worker"><a href="#service-worker" class="header-anchor">#</a> <code>Service Worker</code></h2> <p>ä¹Ÿæ˜¯ <code>PWA</code> æŠ€æœ¯èƒŒåéå¸¸é‡è¦çš„è§’è‰²ï¼Œ<code>Service worker</code> å®é™…ä¸Šæ˜¯ä¸€æ®µ <code>js</code> è„šæœ¬ï¼Œåœ¨åå°è¿è¡Œï¼Œå¹¶ä¸æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è¿è¡Œã€‚å®ƒæ˜¯ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ï¼Œè¿è¡Œç¯å¢ƒä¸æ™®é€šè„šæœ¬ä¸åŒï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥å‚ä¸ <code>Web</code> äº¤äº’è¡Œä¸ºï¼Œæ— æ³•æ“ä½œ <code>dom</code> ç­‰ç­‰ï¼Œ<code>Service Worker</code> çš„å‡ºç°æ˜¯æ­£æ˜¯ä¸ºäº†ä½¿å¾— <code>Web App</code> ä¹Ÿå¯ä»¥åšåˆ°åƒ <code>Native App</code> é‚£æ ·å¯ä»¥ç¦»çº¿ä½¿ç”¨ã€æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½ã€‚<code>Service Worker</code> æ˜¯å…·æœ‰ç”Ÿå‘½å‘¨æœŸçš„ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºï¼šå®‰è£…ã€æ¿€æ´»ã€å¸è½½ã€‚</p> <h2 id="è¯¦ç»†æµç¨‹"><a href="#è¯¦ç»†æµç¨‹" class="header-anchor">#</a> è¯¦ç»†æµç¨‹</h2> <ul><li><h3 id="å®‰è£…ä¾èµ–"><a href="#å®‰è£…ä¾èµ–" class="header-anchor">#</a> å®‰è£…ä¾èµ–</h3></li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>cnpm <span class="token function">install</span> workbox-build gulp gulp-uglify readable-stream uglify-es --save-dev
</code></pre></div><ul><li><h3 id="æ–°å»ºæ–‡ä»¶"><a href="#æ–°å»ºæ–‡ä»¶" class="header-anchor">#</a> æ–°å»ºæ–‡ä»¶</h3> <p>æˆ‘ä»¬é¦–å…ˆåœ¨åšå®¢çš„æ ¹ç›®å½•ä¸‹æ–°å»º <code>gulpfile.js</code> æ–‡ä»¶</p></li></ul> <p>å¤§æ¦‚è§£é‡Šä¸€ä¸‹ <code>gulpfile.js</code> çš„æ–‡ä»¶å†…å®¹ï¼šé¦–å…ˆæ˜¯ <code>gulp</code> ä¼šæ‰§è¡Œä¸€ä¸ªä»»åŠ¡å«<code>generate-service-worker</code>å³ç”Ÿæˆ <code>service-worker</code>ï¼Œå½“ç„¶è¿™ä¸ªä»»åŠ¡åæ˜¯è‡ªå·±éšæ„èµ·çš„ï¼Œç„¶åé€šè¿‡ <code>injectManifest</code> æ³¨å…¥ï¼Œ<code>globPatterns</code> æ˜¯åŒ¹é…çš„æ‰€æœ‰èµ„æºçš„åˆ—è¡¨ï¼Œåšå®¢é¦–æ¬¡åŠ è½½æ—¶ï¼Œè‡ªåŠ¨å°†è¿™äº›æ–‡ä»¶ç¼“å­˜ï¼Œç„¶ååˆ©ç”¨ <code>sw-template.js</code> æ¨¡æ¿ï¼Œæœ€ååœ¨æ‰§è¡Œ <code>gulp build</code> å°±ä¼šåœ¨ <code>hexo generate</code> ä¹‹åçš„ <code>public</code> æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆä¸€ä»½çº¿ä¸Šå¯ç”¨çš„ <code>sw.js</code> æ–‡ä»¶ã€‚ç¬¬äºŒä¸ªä»»åŠ¡æ˜¯å‹ç¼©ç”Ÿæˆçš„ <code>sw</code>ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> workbox <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;workbox-build&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> uglifyes <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;uglify-es&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> composer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;gulp-uglify/composer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> uglify <span class="token operator">=</span> <span class="token function">composer</span><span class="token punctuation">(</span>uglifyes<span class="token punctuation">,</span> console<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> pipeline <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;readable-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>pipeline<span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;generate-service-worker&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> workbox<span class="token punctuation">.</span><span class="token function">injectManifest</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">swSrc</span><span class="token operator">:</span> <span class="token string">&quot;./sw-template.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">swDest</span><span class="token operator">:</span> <span class="token string">&quot;./public/sw.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globDirectory</span><span class="token operator">:</span> <span class="token string">&quot;./public&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globPatterns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;**/*.{html,css,js,json,woff2}&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">modifyURLPrefix</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;uglify&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">pipeline</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token string">&quot;./public/sw.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">uglify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span><span class="token string">&quot;./public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">&quot;build&quot;</span><span class="token punctuation">,</span> gulp<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token string">&quot;generate-service-worker&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;uglify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ç„¶åä¹Ÿåœ¨æ ¹ç›®å½•ä¸‹åˆ›å»º <code>sw-template.js</code> æ–‡ä»¶ï¼Œæˆ‘ç”¨çš„æ˜¯ <code>6.1.0</code> çš„ <code>CDN</code> ç‰ˆæœ¬ã€‚</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ä½¿ç”¨Google Cloud Storageä¸Šçš„Workbox CDN</span>
<span class="token function">importScripts</span><span class="token punctuation">(</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://storage.googleapis.com/workbox-cdn/releases/6.1.0/workbox-sw.js</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// è¿™ä¸ªprefixéå¸¸é‡è¦ï¼Œéœ€è¦æ”¹æˆè‡ªå·±çš„githubçš„name</span>
workbox<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token function">setCacheNameDetails</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">prefix</span><span class="token operator">:</span> <span class="token string">&quot;tennesseesunshine&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

workbox<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token function">skipWaiting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

workbox<span class="token punctuation">.</span>core<span class="token punctuation">.</span><span class="token function">clientsClaim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">precacheAndRoute</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>__WB_MANIFEST<span class="token punctuation">)</span><span class="token punctuation">;</span>

workbox<span class="token punctuation">.</span>precaching<span class="token punctuation">.</span><span class="token function">cleanupOutdatedCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// workbox.routing.registerRoute åˆ©ç”¨æ­£åˆ™æ¥åŒ¹é…æ³¨å†Œè·¯ç”±ï¼Œç±»ä¼¼äºwebpackçš„loaderï¼ŒåŒ¹é…åˆ°ä¹‹åç”¨callbackå¤„ç†</span>

workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(?:png|jpg|jpeg|gif|bmp|webp|svg|ico)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token comment">// ç¼“å­˜å›¾ç‰‡ï¼Œä»¥åŠè®¾ç½®ç¼“å­˜æ—¶é—´</span>
  <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>CacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cacheName</span><span class="token operator">:</span> <span class="token string">&quot;images&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>ExpirationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">maxEntries</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxAgeSeconds</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>CacheableResponsePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">statuses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Fonts</span>
workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(?:eot|ttf|woff|woff2)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>CacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cacheName</span><span class="token operator">:</span> <span class="token string">&quot;fonts&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>ExpirationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">maxEntries</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxAgeSeconds</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>CacheableResponsePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">statuses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Google Fonts</span>
workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\/\/fonts\.googleapis\.com</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>StaleWhileRevalidate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cacheName</span><span class="token operator">:</span> <span class="token string">&quot;google-fonts-stylesheets&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\/\/fonts\.gstatic\.com</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>CacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cacheName</span><span class="token operator">:</span> <span class="token string">&quot;google-fonts-webfonts&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>ExpirationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">maxEntries</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxAgeSeconds</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>CacheableResponsePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">statuses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Static Libraries</span>
workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\/\/cdn\.jsdelivr\.net</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>CacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cacheName</span><span class="token operator">:</span> <span class="token string">&quot;static-libs&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>ExpirationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">maxEntries</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxAgeSeconds</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>CacheableResponsePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">statuses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// External Images</span>
workbox<span class="token punctuation">.</span>routing<span class="token punctuation">.</span><span class="token function">registerRoute</span><span class="token punctuation">(</span>
  <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^https:\/\/raw\.githubusercontent\.com\/reuixiy\/hugo-theme-meme\/master\/static\/icons\/.*</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>strategies<span class="token punctuation">.</span>CacheFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">cacheName</span><span class="token operator">:</span> <span class="token string">&quot;external-images&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>expiration<span class="token punctuation">.</span>ExpirationPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">maxEntries</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
        <span class="token literal-property property">maxAgeSeconds</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">new</span> <span class="token class-name">workbox<span class="token punctuation">.</span>cacheableResponse<span class="token punctuation">.</span>CacheableResponsePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">statuses</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

workbox<span class="token punctuation">.</span>googleAnalytics<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>æ¥ç€åœ¨åšå®¢ä¸»é¢˜çš„ <code>source</code> æºç ä¸‹ï¼Œåˆ›å»º <code>manifest.json</code> æ–‡ä»¶ï¼Œç”¨äºå‘é€åˆ°æ¡Œé¢å¿«æ·æ–¹å¼çš„ä¸€äº›é…ç½®ã€‚</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;å¡«å†™ä½ éœ€è¦çš„åå­—&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;å¡«å†™ä½ éœ€è¦çš„åå­—&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/img/icons.png&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;256x256&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;orientation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;portrait-primary&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;.&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„çš„äº‹é¡¹ï¼š<code>icons</code> ä¸‹çš„ <code>sizes</code> å¿…é¡»æ˜¯æ­£æ–¹å½¢ï¼Œå¹¶ä¸”éœ€è¦å¤§äº <code>144px</code> å·¦å³ï¼Œç”¨ <code>256</code> å°±å¯ä»¥ã€‚</p> <ul><li><h3 id="æ‰§è¡Œ"><a href="#æ‰§è¡Œ" class="header-anchor">#</a> æ‰§è¡Œ</h3>
å…ˆ <code>hexo</code> ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œå†æœ‰ <code>gulp</code> ç”Ÿæˆ <code>sw</code> ç¼“å­˜åˆ—è¡¨ã€‚</li></ul> <div class="language- extra-class"><pre class="language-text"><code>hexo g &amp;&amp; gulp build
</code></pre></div><ul><li><h3 id="ç¼–è¾‘æ¨¡ç‰ˆ"><a href="#ç¼–è¾‘æ¨¡ç‰ˆ" class="header-anchor">#</a> ç¼–è¾‘æ¨¡ç‰ˆ</h3></li></ul> <p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜éœ€è¦åœ¨ <code>HTML</code> é¡µé¢ä¸­åŠ å…¥ç›¸å…³ä»£ç ä»¥æ³¨å†Œ <code>Service Worker</code>ï¼Œå¹¶æ·»åŠ é¡µé¢æ›´æ–°åçš„æé†’åŠŸèƒ½ã€‚è¿™ä¸ªéœ€è¦æ ¹æ®è‡ªå·±çš„ç›®å‰ä½¿ç”¨çš„ä¸»é¢˜æ¥ä¿®æ”¹ï¼Œå…·ä½“åšæ³•å°±æ˜¯æ‰¾åˆ°è‡ªå·±ç›®å‰ä½¿ç”¨åšå®¢ä¸»é¢˜çš„ç›®å½•ï¼Œåœ¨å…¶æ¨¡ç‰ˆç›¸å…³æ–‡ä»¶çš„<code>&lt;/body&gt;</code>ä¸‹ï¼Œæ’å…¥</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app-refresh<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app-refresh<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app-refresh-wrap<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript">location<span class="token punctuation">.</span><span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>å·²æ›´æ–°æœ€æ–°ç‰ˆæœ¬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>ç‚¹å‡»åˆ·æ–°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;serviceWorker&quot;</span> <span class="token keyword">in</span> navigator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span>controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;controllerchange&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// å› ä¸ºåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸‹ä¸éœ€è¦swçš„ç¼“å­˜ï¼Œåœ¨æ›´æ–°åšå®¢ä¹‹åï¼Œåˆ·æ–°ä¼šåˆ·ä¸å‡ºæ¥æ–°çš„åšå®¢å†…å®¹ï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­å¦‚æœæ˜¯çº¿ä¸Šæ‰æ³¨å†Œswå¦åˆ™å°±å¸è½½æ‰</span>

    <span class="token comment">// è¿™é‡Œçš„åˆ¤æ–­æ¡ä»¶å°±æ˜¯è‡ªå·±çš„åšå®¢çš„åŸŸå</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>location<span class="token punctuation">.</span>host <span class="token operator">===</span> <span class="token string">&quot;tennesseesunshine.github.io&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token string">&quot;/sw.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      navigator<span class="token punctuation">.</span>serviceWorker<span class="token punctuation">.</span><span class="token function">getRegistrations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">registrations</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> registration <span class="token keyword">of</span> registrations<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          registration<span class="token punctuation">.</span><span class="token function">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">showNotification</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&quot;meta[name=theme-color]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">&quot;#000&quot;</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;app-refresh&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>className <span class="token operator">+=</span> <span class="token string">&quot; app-refresh-show&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><h3 id="è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼"><a href="#è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼" class="header-anchor">#</a> è®¾ç½®ç«™ç‚¹æ›´æ–°æç¤ºåˆ·æ–°çš„æ ·å¼</h3></li></ul> <p>ä¾æ—§æ˜¯æ‰¾åˆ°è‡ªå·±çš„åšå®¢ä¸»é¢˜ï¼Œæ‰¾åˆ° <code>css</code> æ ·å¼æ–‡ä»¶ï¼Œåœ¨å…¶ä¸‹å¢åŠ <code>_customs/custom.styl</code> æ–‡ä»¶ï¼Œå†™å…¥ä¸€ä¸‹å†…å®¹ï¼š</p> <div class="language-styl extra-class"><pre class="language-styl"><code><span class="token selector">.app-refresh</span>
  <span class="token property-declaration"><span class="token property">background</span> <span class="token hexcode">#000</span></span>
  <span class="token property-declaration"><span class="token property">height</span> <span class="token number">0</span></span>
  <span class="token property-declaration"><span class="token property">line-height</span> <span class="token number">3</span><span class="token unit">em</span></span>
  <span class="token property-declaration"><span class="token property">overflow</span> hidden</span>
  <span class="token property-declaration"><span class="token property">position</span> fixed</span>
  <span class="token property-declaration"><span class="token property">top</span> <span class="token number">0</span></span>
  <span class="token property-declaration"><span class="token property">left</span> <span class="token number">0</span></span>
  <span class="token property-declaration"><span class="token property">right</span> <span class="token number">0</span></span>
  <span class="token property-declaration"><span class="token property">z-index</span> <span class="token number">1031</span></span>
  <span class="token property-declaration"><span class="token property">padding</span> <span class="token number">0</span> <span class="token number">1</span><span class="token unit">em</span></span>
  <span class="token property-declaration"><span class="token property">transition</span> all <span class="token number">.3</span><span class="token unit">s</span> ease</span>
<span class="token selector">.app-refresh-wrap</span>
  <span class="token property-declaration"><span class="token property">display</span> flex</span>
  <span class="token property-declaration"><span class="token property">color</span> <span class="token hexcode">#fff</span></span>

<span class="token selector">.app-refresh-wrap label</span>
  <span class="token property-declaration"><span class="token property">flex</span> <span class="token number">1</span></span>

<span class="token selector">.app-refresh-show</span>
  <span class="token property-declaration"><span class="token property">height</span> <span class="token number">3</span><span class="token unit">em</span></span>

</code></pre></div><p>å†äºç»Ÿä¸€å¯¼å‡ºçš„ <code>styl</code> çš„æ–‡ä»¶ä¸­ï¼Œå¼•å…¥
<code>@import &quot;\_customs/custom&quot;</code></p> <p>è‡³æ­¤æ‰€æœ‰çš„é…ç½®éƒ½å·²ç»å®Œæˆã€‚</p> <h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="header-anchor">#</a> å‚è€ƒ</h2> <p><a href="https://io-oi.me/tech/pwa-via-workbox/" target="_blank" rel="noopener noreferrer">åˆ©ç”¨ Workbox å®ç°åšå®¢çš„ PWA<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://guanqr.com/tech/website/realize-pwa/" target="_blank" rel="noopener noreferrer">åšå®¢å®ç° PWA åŠŸèƒ½<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°:</span> <span class="time">2/12/2023, 7:42:22 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/blog/notes/browser/web-performance.html" class="prev">
        éƒ¨åˆ† web æ€§èƒ½ä¼˜åŒ–æ¸…å• ğŸ§¾
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.f8d55777.js" defer></script><script src="/blog/assets/js/2.9875f188.js" defer></script><script src="/blog/assets/js/18.eac3edd8.js" defer></script>
  </body>
</html>
